# Firebird driver feature map (3.0-5.0)

This note gives driver authors a concise, version-aware checklist of SQL features and wire-level surprises across Firebird 3.0, 4.0 and 5.0.

## Baseline: always present from Firebird 3.0
- Core scalar types: SMALLINT/INTEGER/BIGINT, NUMERIC/DECIMAL (precision <= 18), FLOAT/DOUBLE, DATE/TIME/TIMESTAMP, CHAR/VARCHAR with collations, BLOB (all subtypes), ARRAY, and BOOLEAN
- Boolean type and constants TRUE/FALSE/UNKNOWN, wire type `FB_BOOLEAN` for API binding
- Identity columns: `GENERATED BY DEFAULT AS IDENTITY` with optional `START WITH`/`INCREMENT` clauses
- RETURNING clause on DML statements yields a single row (treat as cursor) - unchanged in later versions unless noted.
- Time context variables return types without time zone: `CURRENT_TIME` -> `TIME`, `CURRENT_TIMESTAMP` -> `TIMESTAMP`.

## Changes: Firebird 3.0 -> 4.0 (add support when engine >= 4)
- New scalar types
  - `INT128` integer
  - Decimal floating point `DECFLOAT(16|34)` plus session controls via `SET DECFLOAT`
  - `FLOAT(bin_prec)` syntax variant for binary precision
- Time-zone aware datetime
  - `TIME WITH TIME ZONE` and `TIMESTAMP WITH TIME ZONE` plus session time zone support
  - Datetime literals become strict; mnemonics like `'NOW'` are no longer accepted in casts
  - `CURRENT_TIME` / `CURRENT_TIMESTAMP` now return the time-zone-aware types; `LOCALTIME` / `LOCALTIMESTAMP` were added to preserve legacy semantics
- Identity columns
  - New `GENERATED ALWAYS` mode
  - `OVERRIDING USER|SYSTEM VALUE` in `INSERT` controls identity assignment (needed for bulk loads)
- Character/binary
  - `CHAR/VARCHAR CHARACTER SET OCTETS` gain the aliases `BINARY` / `VARBINARY`
- Compatibility switch
  - Config `DataTypeCompatibility=3.0|2.5` can coerce new types (DECFLOAT, INT128, TIMESTAMP WITH TZ, high-precision NUMERIC) to legacy equivalents; drivers should surface an option to opt out/in.
- System metadata additions
  - `RDB$TIME_ZONES` for tz names/offsets; replication tables `RDB$PUBLICATIONS`* allow detecting logical replication capabilities. (*Relevant when drivers expose management APIs.)

## Changes: Firebird 4.0 -> 5.0 (add support when engine >= 5)
- Time context variables split
  - `CURRENT_TIME` / `CURRENT_TIMESTAMP` keep the time-zone-aware types.
  - `LOCALTIME` now returns `TIME WITHOUT TIME ZONE`; `LOCALTIMESTAMP` returns `TIMESTAMP WITHOUT TIME ZONE` (important for parameter/column typing)
  - Default precision differs: `CURRENT_TIME` defaults to 0 fractional seconds, `CURRENT_TIMESTAMP` to 3; allow explicit precision argument `(...0-3)`
- `INSERT ... SELECT ... RETURNING`
  - Now produces zero or more rows and is classified as a SELECT (`isc_info_sql_stmt_select`); drivers must open a result-set cursor instead of expecting a single returned row
- BLOB handling
  - Creating or concatenating text BLOBs now uses the **connection character set** for new empty values instead of `NONE` (affects client-side charset selection)
  - New BLOB utility functions and the `BLOB_APPEND` helper are documented in the system package `RDB$BLOB_UTIL`
- Introspection
  - `RDB$KEYWORDS` virtual table exposes reserved words/keywords - useful for escaping decisions in generators
  - Monitoring adds `MON$COMPILED_STATEMENTS`; profiling tables `PLG$PROF_*` ship with the Default_Profiler plugin
- Misc runtime
  - Index creation may run in parallel (affects monitoring but not SQL surface).

## Quick feature matrix

| Feature / Surface                           | 3.0 | 4.0 | 5.0 |
|---------------------------------------------|-----|-----|-----|
| BOOLEAN type                                |  Y  |  Y  |  Y  |
| Identity column `GENERATED BY DEFAULT`      |  Y  |  Y  |  Y  |
| Identity column `GENERATED ALWAYS`          |  -  |  Y  |  Y  |
| `OVERRIDING USER/SYSTEM VALUE` in INSERT    |  -  |  Y  |  Y  |
| INT128                                      |  -  |  Y  |  Y  |
| DECFLOAT(16/34)                             |  -  |  Y  |  Y  |
| TIME/TIMESTAMP WITH TIME ZONE               |  -  |  Y  |  Y  |
| `LOCALTIME`/`LOCALTIMESTAMP` (no TZ result) |  -  |  Y* |  Y  |
| `LOCALTIME` returns WITHOUT TZ              |  -  |  N  |  Y  |
| BINARY/VARBINARY aliases                    |  -  |  Y  |  Y  |
| `INSERT ... SELECT ... RETURNING` gives result set | Y¹ | Y¹ | Y² |
| BLOB default charset = connection charset   |  N  |  N  |  Y  |
| RDB$TIME_ZONES table                        |  -  |  Y  |  Y  |
| RDB$KEYWORDS table                          |  -  |  -  |  Y  |
| MON$COMPILED_STATEMENTS                     |  -  |  -  |  Y  |

Notes: Y = supported; N = not supported; - = not applicable.  
¹ Single-row RETURNING; driver may treat as cursor but row count is 1.  
² Multiple rows possible; treat as SELECT-class statement.  
* In 4.0 these are synonyms for the TZ-aware CURRENT_* expressions; result types carry time zone.

## Runtime detection tips for drivers
- Read engine version: `select rdb$get_context('SYSTEM','ENGINE_VERSION') from rdb$database;` and branch on major version.
- Feature probes for safety:
  - `select 1 from rdb$types where rdb$type_name = 'TIME WITH TIME ZONE';` -> presence of TZ types (4+).
  - `select 1 from rdb$keywords rows 1;` -> succeeds only on 5.0+.
  - `select 1 from rdb$time_zones rows 1;` -> 4.0+.
- Respect server-side compatibility knobs (e.g., `DataTypeCompatibility`) that can downgrade type IDs; when available, expose a client setting to opt into native 4+/5+ types.

## Linking cheat-sheet (most-used anchors)
- BOOLEAN: https://www.firebirdsql.org/file/documentation/html/en/refdocs/fblangref30/firebird-30-language-reference.html#fblangref30-datatypes-boolean
- Identity (3.0): https://www.firebirdsql.org/file/documentation/html/en/refdocs/fblangref30/firebird-30-language-reference.html#fblangref30-ddl-tbl-identity
- Identity (4.0, GENERATED ALWAYS): https://www.firebirdsql.org/file/documentation/html/en/refdocs/fblangref40/firebird-40-language-reference.html#fblangref40-ddl-tbl-identity-always
- INSERT OVERRIDING: https://www.firebirdsql.org/file/documentation/html/en/refdocs/fblangref40/firebird-40-language-reference.html#fblangref40-dml-insert-overriding
- INT128: https://www.firebirdsql.org/file/documentation/html/en/refdocs/fblangref40/firebird-40-language-reference.html#fblangref40-datatypes-int128
- DECFLOAT: https://www.firebirdsql.org/file/documentation/html/en/refdocs/fblangref40/firebird-40-language-reference.html#fblangref40-datatypes-decfloat
- Time zone types: https://www.firebirdsql.org/file/documentation/html/en/refdocs/fblangref40/firebird-40-language-reference.html#fblangref40-datatypes-session-tz
- BINARY/VARBINARY aliases: https://www.firebirdsql.org/file/documentation/html/en/refdocs/fblangref40/firebird-40-language-reference.html#fblangref40-datatypes-chartypes
- CURRENT_TIME/LOCALTIME (5.0 semantics): https://www.firebirdsql.org/file/documentation/html/en/refdocs/fblangref50/firebird-50-language-reference.html#fblangref50-contextvars-current-time
- INSERT ... RETURNING (5.0): https://www.firebirdsql.org/file/documentation/html/en/refdocs/fblangref50/firebird-50-language-reference.html#fblangref50-dml-insert-returning
- BLOB specifics (charset behaviour): https://www.firebirdsql.org/file/documentation/html/en/refdocs/fblangref50/firebird-50-language-reference.html#fblangref50-datatypes-bnrytypes-more
- RDB$KEYWORDS: https://www.firebirdsql.org/file/documentation/html/en/refdocs/fblangref50/firebird-50-language-reference.html#fblangref-appx04-keywords
- MON$COMPILED_STATEMENTS: https://www.firebirdsql.org/file/documentation/html/en/refdocs/fblangref50/firebird-50-language-reference.html#fblangref50-appx05-moncompst
